<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sequence Market AutoLogin</title>
  <script src="https://cdn.jsdelivr.net/npm/@0xsequence/provider@latest/dist/sequence-provider.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@0xsequence/wallet@latest/dist/sequence-wallet.min.js"></script>
</head>
<body>
  <script>
    // Reemplaza esto con los datos reales que generas desde Unity
    const intentPayload = {
      intent: {
        data: {
          wallet: "0x81437d2D4159cEaF351b2D6a55E1e2f695CBC5dE"
        },
        expiresAt: 1749084370,
        issuedAt: 1749084340,
        name: "listSessions",
        signatures: [
          {
            sessionId: "0x0081437d2d4159ceaf351b2d6a55e1e2f695cbc5de",
            signature: "0xca10f18107669ebdbfb5f5d3e46ac557470ecf2140ec80cc9c475bf58e96640b228dcbb7b5a6e665410a15ba87927595d3bca66af0eb7ae6b2efbe75a2e20cd81c"
          }
        ],
        version: "1 (Unity 4.2.1)"
      }
    }

    async function loginAndRedirect() {
      const wallet = new sequence.Wallet("polygon", { defaultNetwork: "polygon" });
      await wallet.connect({ app: "Your Game", authorize: true });
      const address = await wallet.getAddress();

      // Puedes hacer validación adicional del intent aquí si deseas
      if (address.toLowerCase() === intentPayload.intent.data.wallet.toLowerCase()) {
        // Redirige a tu market ya filtrado con wallet
        const marketUrl = `https://courageous-polar-bear-35805.sequence.market/421614/${address}/items`;
        window.location.href = marketUrl;
      } else {
        alert("La wallet conectada no coincide con el intent.");
      }
    }

    loginAndRedirect();
  </script>
</body>
</html>
